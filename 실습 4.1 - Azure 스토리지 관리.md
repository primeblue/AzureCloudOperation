# 실습 4.1 - Azure 스토리지 관리



### 작업 1: windows 가상서버 생성하고 디스크추가하기

   1. azure portal 로 로그인합니다.

   2. 새로운 리소스그룹을 생성합니다. 

            	1. 이름 : userxx-rg1
            	2. 영역: 미국동부

   3. 새로운 가상머신을 생성합니다.

          	1. 리소스그룹: userxx-rg1
          	2. 가상머신이름: userxxWinVM01
          	3. 지역: 미국동부
          	4. 이미지: windows 2016 datacenter 
          	5. 크기: D2s_v3
          	6. 관리자계정 : azureadmin , Password!234
          	7. OS 디스크유형: 표준 HDD
          	8. 네트워킹: 기본설정
          	9. 관리: 부트진단 끄기

   4. 생성한 윈도우 가상머신에 연결 -> RDP 로 접속하여 관리자계정으로 로그인합니다.

   5. 윈도우즈 2016 에서 시작 -> 컴퓨터관리자 -> 디스크관리자 를 클릭하여 현재 윈도우컴퓨터가 어떤 디스크와 볼륨을 가지고 있는지 확인해봅니다.

   6. Azure Portal 에서 컴퓨팅서비스중에 디스크를 클릭하여 새로운 디스크를 생성해줍니다.

          	1. 리소스그룹: userxx-rg1

          	2. 디스크이름: userxxWindisk01

          	3. 지역: 미국동부

          	4. 크기 : 크기변경 -> 표준 HDD : 32GiB

              

   7. userxxWinVM01 가상머신을 클릭하여 메뉴블레이드에서 디스크 클릭 -> 데이타디스크추가하여 6번과정에서 생성한 디스크를 연결시켜준다.

   8. windows 가상머신의 원격데스크탑에 접속하여 디스크관리자를 통해 추가된 디스크에 대한 정보를 확인해본다.

### 작업 2: Azure 스토리지 계정 생성 및 구성

이 작업에서는 Azure 스토리지 계정을 만들고 구성합니다.

1. Azure 포털에서 **스토리지 계정**을 검색하고 선택한다. **+ 추가**를 클릭한다.

2. **스토리지 계정 만들기** 블레이드의 **기본 사항** 탭을 다음과 같이 설정한다. (다른 값은 기본 설정을 사용한다)

   | 설정               | 값                                              |
   | ------------------ | ----------------------------------------------- |
   | 구독               | 이 랩에서 사용할 Azure 구독의 이름              |
   | 리소스 그룹        | userxx-rg1                                      |
   | 스토리지 계정 이름 | userxxscxx                                      |
   | 위치               | Azure 스토리지를 만들 수 있는 Azure region 이름 |
   | 성능               | **표준**                                        |
   | 계정 종류          | **Storage (범용 v1)**                           |
   | 복제               | **RA-GRS(읽기 액세스 지역 중복 스토리지)**      |

3. **다음: 네트워킹 >** 을 클릭한다. **스토리지 계정 만들기** 블레이드의 **네트워킹** 탭에서 가능한 옵션을 검토하고 기본 값인 **공용 엔드포인트 (모든 네트워크)** 를 사용한다.

4.  **검토 + 만들기**를 클릭하고, 유효성 검사가 끝나면 **만들기**를 클릭한다.

   > **참고**: 스토리지 계정이 만들어질 때까지 기다리십시오. 이 과정은 약 2분 정도 소요됩니다.

5. 배포 블레이드에서 **리소스로 이동**을 클릭해 Azure 스토리지 계정 블레이드로 이동한다.

6. 스토리지 계정 블레이드 **설정** 섹션의 **구성**을 클릭한다.

7. **업그레이드**를 클릭해 **Storage (범용 v1)** 를 **StorageV2 (범용 v2)** 로 업그레이드 한다.

8. **스토리지 계정 업그레이드** 블레이드에서 업그레이드는 영구적이며 청구 비용이 변경된다는 경고 메시지를 검토한다. **업그레이드 확인** 텍스트 박스에 스토리지 계정의 이름을 입력하고 **업그레이드**를 클릭한다.

   > **참고**: 프로비저닝할 때 **StorageV2 (범용 v2)** 로 계정을 설정할 수도 있습니다. 기존 범용 v1 계정을 범용 v2로 업그레이드할 수 있는 옵션을 확인하기 위한 실습입니다.

   > **참고**: **StorageV2 (범용 v2)** 는 범용 v1 계정에서는 제공하지 않는 access tiering(액세스 계층) 등 다양한 기능을 제공합니다.

   > **참고**: 구성 옵션을 검토합니다. **핫**으로 설정된 **액세스 계층 (기본값)**, **표준**으로 설정된 **성능**, Azure 액티브 디렉토리 도메인 서비스가 필요한 **파일 공유에 대한 ID 기반 액세스**가 있습니다. 액세스 계층에 대한 설정은 바꿀 수 있지만, 성능은 계정을 프로비저닝 하는 단계에서만 설정할 수 있습니다.

9. 스토리지 계정 블레이드의 **설정** 섹션에서 **지역에서 복제**를 클릭하고 보조 지역(secondary location)을 확인한다. **스토리지 엔드포인트** 라벨 밑의 **모두 보기** 링크를 클릭하고, **스토리지 계정 엔드포인트** 블레이드를 검토한다.

   > **참고**: **스토리지 계정 엔드포인트** 블레이드에서는 기본 엔드포인트와 보조 엔드포인트를 확인할 수 있다.

10. 스토리지 계정의 **구성** 블레이드로 돌아간다. **복제** 드롭다운 리스트에서 **LRS(로컬 중복 스토리지)** 를 선택하고 변경 사항을 저장한다.

11. **지역에서 복제** 블레이드로 돌아가서, 이번에는 스토리지 계정에 기본 지역만 명시되어 있는 것을 확인한다.

12. 스토리지 계정의 **구성** 블레이드로 돌아가서 **액세스 계층 (기본)** 을 **쿨**로 설정한다.

    > **참고**: 쿨 액세스 계층은 자주 접근하지 않는 데이터에 적합합니다.

### 작업 3: Blob 스토리지 관리

이 작업에서는 Blob 컨테이너를 만들고 blob을 업로드합니다.

1. 스토리지 계정 블레이드에 **Blob service** 섹션의 **컨테이너**를 클릭한다.

2. **+ 컨테이너**를 클릭하고, 다음 설정을 사용한다.

   | 설정             | 값                                  |
   | ---------------- | ----------------------------------- |
   | 이름             | **userxx-container**                |
   | 공용 액세스 수준 | 컨테이너와 Blob  에 대한 읽기액세스 |

3. 새로 생성한 컨테이너 안에 각자 가지고 계시는 작은 사이즈의 그림파일하나를 업로드해본다.

4. 방금 업로드한 그림파일을 클릭하면 file 에 액세스할수 있는 URL 을 복사해둔다.

5. 로컬컴퓨터에서 notepad 을 열어서 간단한 index.html 문서 와 404.html 를 작성해본다.

   ```
   <html> 
   <head>     
   <title>My Website Home Page</title> 
   </head>
    <body>   
   <h1>Welcome to my website</h1>  
    <p>Now hosted on Azure Container Storage!</p> 
   <p><img src="이부분에 위에서 복사한 url 을 붙여넣기 하세요">
   </p> 
   </body> 
   </html> 
   ```

   ```
   <html> 
   <head>     
   <title>Sorry!!</title> 
   </head>
    <body>   
   <h1>There are some problems !!</h1>  
   </body> 
   </html> 
   ```

   

   생성하신 index.html 문서도 container 에 업로드 한다.

   6. 브라우저를 열어서 index.html 의 URL 로 연결해봅니다.

### 작업 4 Azure Files 공유 생성 및 구성

이 작업에서는 Azure Files 공유를 생성하고 구성합니다.



1. Azure 포털에서 이 랩의 첫 번째 작업에서 생성한 스토리지 계정의 블레이드를 찾는다. **파일 서비스** 섹션에서 **파일 공유**를 클릭한다.

2. **+ 파일 공유**를 클릭하고 다음 설정을 사용해 파일 공유를 생성한다.

   | 설정   | 값               |
   | ------ | ---------------- |
   | 이름   | **userxx-share** |
   | 할당량 | 10               |

3. 새로 만든 파일 공유를 클릭하고, **연결**을 클릭한다.

4. **연결** 블레이드에서 **윈도우** 탭이 선택된 것을 확인하고 **클립보드로 복사**를 클릭한다.

5. Azure 포털에서 **가상 머신**을 찾아 선택하고,userxxWinVM01을 클릭한다.

6. userxxWinVM01 에 RDP 로 접속하여 powershell 을 실행한다

7. Y 드라이브에 azure file storage 가 매핑이 되었는지 확인한다. 

8. **PowerShell 에서 다음과 명령어를 실행하여 폴더와 파일을 생성해본다.

   ```
   New-Item -Type Directory -Path 'Z:\userxx-folder'
   
   New-Item -Type File -Path 'Z:\userxx-folder\az-104-07-file.txt'
   ```

   

9. **userxx-share** 파일 공유 블레이드로 돌아간다. **새로 고침**을 클릭하고, 폴더 목록에서 **userxx-folder**를 확인한다.

10. **userxx-folder**를 클릭하고, **userxx-file.txt**가 파일 목록에 있는지 확인한다.

### 작업5 정적웹사이트 호스팅과 Azure CDN 연동하기

1. azure portal 에 로그인하여 위에서 생성한 스토리지계정(userxxscxx) 을 클릭한다

2. 설정 메뉴 블레이드중에 정적 웹 사이트 를 클릭한다.

3. 정적 웹 사이트를 사용으로 전환하고 저장버튼을 클릭한다.

   1. 인덱스문서이름: index.html
   2. 오류문서경로: 404.html

4. Blob service 블레이드메뉴중 컨테이너를 클릭한다.

5. $web 과 $log 컨테이너가 추가된것을 확인해볼수 있다.

6. $web 컨테이너를 클릭하여  작업3.5 에서 생성하신 index.html 과 404.html 파일을 업로드한다.

7. 정적웹사이트 블레이드에 가서 기본 엔드포인트 URL 을 복사한다.

8. 브라우저을 열어서 복사한 URL 로 접속해본다.

9. 스토리지계정의 Blob service 블레이드 중에 Azure CDN 을 클릭한다.

10. CDN 프로픽은 가격 책정 계층 및 공급자를 공유하는 CDN 끝점입니다. 새로운 프로픽을 작성합니다.

    1. 프로필이름: userxxcdnprofile   
    2. 가격책정계층: 표준 microsoft
    3. cdn 엔드포인트이름 : userxxcdnxx( userxxcndxx.azureedge.net ) <- cdn 의 끝점이므로 글로벌하게 unique 한 이름이어야합니다.
    4. 원본호스트이름: 정적웹사이트 선택

    새로운 cdn 프로필의 엔드포인트를 생성합니다. 

11. CDN 엔드포인트가 올바르게 구성되었는지 확인하려면 cdn 엔드포인트를 클릭하여 해당 설정으로 이동합니다. 스토리지 계정에 대한 CDN 개요에 헨드포인트 호스트 이름을 찾아 해당 엔드포인트로 이동합니다.

12. CDN 의 엔드포인트로 이동하면 이전에 정적 웹 사이트에 업로드한 index.html 파일의 내용이 표시됩니다. 

13. cdn의 엔드포인트를 완료하는데는 5분~10분정도가 소요됩니다. 페이지에 접속이 안되면 잠시 뒤에 다시 접속을 시도해 보십시오.

### 리소스 삭제

> **참고**: 사용하지 않는 새로 생성된 Azure 리소스를 제거하십시오. 사용하지 않는 리소스를 제거해야 예상치 못한 비용이 발생하지 않습니다.

1. Azure 포털에서 **Cloud Shell**의 **PowerShell** 세션을 시작한다.

2. 다음 명령을 실행하여 이 모듈의 실습에서 생성된 모든 리소스 그룹을 나열한다.

   ```
   Get-AzResourceGroup -Name 'userxx*'
   ```

3. 다음 명령을 실행하여 이 모듈의 실습에서 생성한 모든 리소스 그룹을 삭제한다.

   ```
   Get-AzResourceGroup -Name 'userxx*' | Remove-AzResourceGroup -Force -AsJob
   ```

   > **참고**: 이 명령은 비동기적으로 실행되므로( --nowait 매개 변수로 결정됨) 동일한 PowerShell 세션 내에서 즉시 다른 PowerShell 명령을 실행할 수 있지만, 리소스 그룹이 실제로 제거되기까지는 몇 분 정도 소요됩니다.

### 
